/* lightrouter.js - Copyright 2014 Gary Green. Licensed under the Apache License, Version 2.0 */!function(t){"undefined"!=typeof exports?module.exports=t():window.LightRouter=t(window)}(function(t){function e(e){this.pathRoot="",this.routes=[],this.type="path",this.path=null,this.hash=null,this.context=this,this.handler=t;var s="([\\w-]+)";if(this.namedParam={match:new RegExp("{("+s+")}","g"),replace:s},e=e||{},e.type&&this.setType(e.type),e.path&&this.setPath(e.path),e.pathRoot&&this.setPathRoot(e.pathRoot),e.hash&&this.setHash(e.hash),e.context&&this.setContext(e.context),e.handler&&this.setHandler(e.handler),e.routes){var h;for(h in e.routes)this.add(h,e.routes[h])}}function s(t,e){this.options=t,this.router=e,this.values=[]}return e.prototype={Route:s,add:function(t,e){return this.routes.push(new this.Route({route:t,callback:e},this)),this},empty:function(){return this.routes=[],this},setType:function(t){return this.type=t,this},setPathRoot:function(t){return this.pathRoot=t,this},setPath:function(t){return this.path=t,this},setHash:function(t){return this.hash=t,this},setContext:function(t){return this.context=t,this},setHandler:function(t){return this.handler=t,this},getUrl:function(e){var s;if(e=e||this.type,"path"==e){var h=new RegExp("^"+this.pathRoot+"/?");s=this.path||t.location.pathname.substring(1),s=s.replace(h,"")}else"hash"==e&&(s=this.hash||t.location.hash.substring(1));return decodeURI(s)},run:function(){var t,e=this.getUrl();for(var s in this.routes)if(t=this.routes[s],t.test(e))return t.run(),t}},s.prototype={regex:function(){var t=this.options.route;return"string"==typeof t?new RegExp("^"+t.replace(/\//g,"\\/").replace(this.router.namedParam.match,this.router.namedParam.replace)+"$"):t},params:function(){var t,e,s={},h=this.values,r=h,i=0,n=this.options.route;"string"==typeof n&&(i=1,r=n.match(this.router.namedParam.match));for(e in r)t=i?r[e].replace(this.router.namedParam.match,"$1"):e,s[t]=h[e];return s},test:function(t){var e;return(e=t.match(this.regex()))?(this.values=e.slice(1),!0):!1},run:function(){return"string"==typeof this.options.callback?this.router.handler[this.options.callback](this.params()):this.options.callback.apply(this.router.context,[this.params()])}},e});